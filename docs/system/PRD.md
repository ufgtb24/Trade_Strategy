# 突破选股策略系统 PRD

**相关文档**：
- 开发状态 → [current_state.md](current_state.md)
- 模块设计 → [../modules/specs/](../modules/specs/)

---

## 一、项目概述

### 1.1 项目目标

开发一套完整的突破选股策略系统，用于美股市场的量化交易，实现：
- 自动识别历史阻力位（凸点）和突破走势
- 多阶段筛选和质量评估
- 双观察池监测机制（实时+日K）
- 实盘自动交易和风险管理
- 策略回测和参数优化

### 1.2 核心策略机制

**策略流程**：搜索 → 监测 → 交易 → 持仓管理

**核心概念**：
- **凸点**：股价高于两侧一定时段的高点，形成历史阻力位
- **突破点**：股价高于凸点最高价，确认突破
- **双观察池**：
  - 实时观察池：监测当日突破，防止直接起飞
  - 日K观察池：监测突破后回落，等待企稳走强
- **循环跟踪**：止盈止损后重新加入观察池，捕捉多轮波动

### 1.3 技术栈

- **编程语言**：Python 3.8+
- **数据源**：Tiger Open API（美股实时/历史行情）
- **交易接口**：Tiger Open API（下单、撤单、查询）
- **回测框架**：Backtrader（可选）或自研回测引擎
- **参数优化**：Optuna
- **数据存储**：SQLite / PostgreSQL
- **核心库**：pandas, numpy, scipy, matplotlib, pyyaml

---

## 二、系统架构

### 2.1 模块总览

本系统划分为12个核心模块，按功能分层：

| 层级 | 模块 | 职责 |
|------|------|------|
| **基础层** | [数据层（data）](../modules/specs/01_数据层_PLAN.md) | 封装Tiger API，提供历史/实时数据获取、本地缓存、实时行情订阅 |
| **基础层** | [配置管理（config）](../modules/specs/09_配置管理_PLAN.md) | 管理系统参数（YAML格式），提供配置验证、加载、持久化功能 |
| **基础层** | [工具与辅助（utils）](../modules/specs/10_工具与辅助_PLAN.md) | 提供日志记录、数据库操作、日期处理等通用工具 |
| **基础层** | [交互式UI（UI）](../modules/specs/12_交互式UI_IMPL.md) | 提供批量扫描管理、交互式股票浏览、实时参数调整、键盘导航等交互功能 (已实现) |
| **分析层** | [技术分析（analysis）](../modules/specs/02_技术分析模块_IMPL.md) | 识别历史凸点（阻力位）、检测突破走势、对峰值和突破进行质量评分（策略核心算法）(已实现) |
| **应用层** | [搜索系统（search）](../modules/specs/03_搜索系统_PLAN.md) | 扫描美股市场，搜索历史突破股票，按质量评分过滤候选标的 |
| **应用层** | [观察池（observation）](../tmp_plans/04_观察池系统_PLAN.md) | 管理实时池和日K池，负责股票入池、出池、池间转换，跟踪潜在突破标的 |
| **应用层** | [监测系统（monitoring）](../modules/specs/05_06_07_实盘交易系统_PLAN.md) | 实时监控观察池中的股票，检测买入信号（突破确认、企稳走强），发送交易警报 |
| **应用层** | [交易执行（trading）](../modules/specs/05_06_07_实盘交易系统_PLAN.md) | 通过Tiger API执行买卖操作，管理订单状态，追踪持仓信息 |
| **应用层** | [风险管理（risk）](../modules/specs/05_06_07_实盘交易系统_PLAN.md) | 实现止盈止损策略（移动止损、固定止损），控制仓位规模，管理风险敞口 |
| **验证层** | [回测系统（backtest）](../modules/specs/08_回测系统_PLAN.md) | 使用历史数据回测策略，生成性能报告（收益率、夏普比率、最大回撤），进行参数优化 |

### 2.2 模块依赖关系

```
┌─────────────────────────────────────────────────────────┐
│                    配置管理 (config)                     │ ← 全局依赖
│                  工具与辅助 (utils)                      │
└─────────────────────────────────────────────────────────┘
                            ↑
┌───────────────────────────┼───────────────────────────┐
│                      数据层 (data)                      │
│  - TigerDataAdapter                                    │
│  - DataCache                                           │
│  - RealtimeStream                                      │
└───────────────────────────┬───────────────────────────┘
                            ↓
┌───────────────────────────┼───────────────────────────┐
│                  技术分析模块 (analysis)                 │
│  - PeakDetector (凸点识别)                             │
│  - BreakoutDetector (突破检测)                         │
│  - QualityScorer (质量评分)                            │
└───────────────────────────┬───────────────────────────┘
                            ↓
         ┌──────────────────┴──────────────────┐
         ↓                                     ↓
┌────────────────────┐              ┌────────────────────┐
│  搜索系统 (search)   │              │ 观察池 (observation)│
│  - HistoricalScanner│──────────→  │  - RealtimePool    │
│  - StockFilter      │              │  - DailyPool       │
│  - SearchEngine     │              │  - PoolManager     │
└────────────────────┘              └─────────┬──────────┘
                                              ↓
                                    ┌────────────────────┐
                                    │ 监测系统 (monitoring)│
                                    │  - RealtimeMonitor │
                                    │  - SignalDetector  │
                                    └─────────┬──────────┘
                                              ↓
                                    ┌────────────────────┐
                                    │ 交易执行 (trading)  │
                                    │  - TigerTradeAPI   │
                                    │  - OrderManager    │
                                    │  - PositionTracker │
                                    └─────────┬──────────┘
                                              ↓
                                    ┌────────────────────┐
                                    │ 风险管理 (risk)     │
                                    │  - StopLossManager │
                                    │  - TakeProfitMgr   │
                                    └────────────────────┘
         ┌──────────────────────────────────┘
         ↓
┌────────────────────┐
│  回测系统 (backtest)│
│  - BacktestEngine  │
│  - ParamOptimizer  │
└────────────────────┘
```

## 三、术语表

| 术语 | 英文 | 定义 |
|------|------|------|
| 凸点/峰值 | Peak/pk | 股价高于两侧一定时段的高点，形成历史阻力位 |
| 突破点 | Breakout Point/Breakthrough/bt | 股价高于凸点最高价，确认突破 |
| 实时观察池 | Realtime Observation Pool | 监测当日突破的股票，使用分钟行情 |
| 日K观察池 | Daily Observation Pool | 监测突破后回落的股票，使用日K行情 |
| 质量评分 | Quality Score | 对凸点和突破点的历史意义进行量化评估 |
| 循环跟踪 | Cyclic Tracking | 止盈止损后重新加入观察池，捕捉多轮波动 |
| 移动止损 | Trailing Stop Loss | 根据最高价动态调整止损价位 |

---
> *本文档为静态参考，动态开发状态请查看 [current_state.md](current_state.md)*
