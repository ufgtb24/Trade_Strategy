# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**çªç ´é€‰è‚¡ç­–ç•¥ç³»ç»Ÿ**ï¼ˆBreakthroughStrategyï¼‰ï¼Œç”¨äºç¾è‚¡å¸‚åœºé‡åŒ–äº¤æ˜“çš„Pythoné¡¹ç›®ã€‚ç³»ç»Ÿé€šè¿‡è¯†åˆ«å†å²é˜»åŠ›ä½ï¼ˆå‡¸ç‚¹ï¼‰å’Œä»·æ ¼çªç ´æ¥ç”Ÿæˆäº¤æ˜“ä¿¡å·ã€‚

**æ ¸å¿ƒç­–ç•¥**ï¼š
- è¯†åˆ«è‚¡ä»·çš„å†å²å³°å€¼ï¼ˆå‡¸ç‚¹ï¼‰ä½œä¸ºé˜»åŠ›ä½
- æ£€æµ‹ä»·æ ¼çªç ´è¿™äº›é˜»åŠ›ä½çš„æ—¶æœº
- ä½¿ç”¨åŒè§‚å¯Ÿæ± ç³»ç»Ÿï¼ˆå®æ—¶è§‚å¯Ÿæ±  + æ—¥Kè§‚å¯Ÿæ± ï¼‰ç›‘æµ‹çªç ´åçš„èµ°åŠ¿
- è‡ªåŠ¨äº¤æ˜“æ‰§è¡Œå’Œé£é™©ç®¡ç†

**å…³é”®ç‰¹æ€§**ï¼š
- **å¢é‡å¼æ¶æ„**ï¼šæ”¯æŒå®æ—¶ç›‘æ§å’Œå†å²å›æµ‹ï¼Œç®—æ³•ä¸€è‡´æ€§ä¿è¯
- **å¤šå³°å€¼çªç ´è¯†åˆ«**ï¼šä¸€æ¬¡çªç ´å¯èƒ½åŒæ—¶çªç ´å¤šä¸ªå¯†é›†é˜»åŠ›ä½
- **è´¨é‡è¯„åˆ†ç³»ç»Ÿ**ï¼šç»¼åˆè¯„ä¼°å³°å€¼å¼ºåº¦å’Œçªç ´è´¨é‡

## å¼€å‘ç¯å¢ƒé…ç½®

### Pythonç¯å¢ƒ
- **Pythonç‰ˆæœ¬**ï¼š3.8+
- **åŒ…ç®¡ç†**ï¼šä½¿ç”¨é…ç½®çš„å¿«é€Ÿpipé•œåƒï¼ˆç”¨æˆ·å·²é…ç½®ï¼‰
- **ä¾èµ–**ï¼špandas, numpy, scipy, matplotlib, tigeropenï¼ˆTiger API SDKï¼‰

### é‡è¦é…ç½®
- **å…¥å£ç¨‹åºå‚æ•°**ï¼šä¸ä½¿ç”¨argparseï¼Œæ‰€æœ‰å‚æ•°ä½œä¸ºå˜é‡å£°æ˜åœ¨main()å‡½æ•°èµ·å§‹ä½ç½®
- **MCPå·¥å…·**ï¼šå¯ä½¿ç”¨context7 MCPæŸ¥è¯¢æ–‡æ¡£ï¼ˆé…ç½®åœ¨.mcp.jsonï¼‰

## ä»£ç æ¶æ„

### ç›®å½•ç»“æ„

```
Trade_Strategy/
â””â”€â”€ BreakthroughStrategy/          # çªç ´ç­–ç•¥ç³»ç»Ÿï¼ˆä¸»æ¨¡å—ï¼‰
    â”œâ”€â”€ analysis/                   # æŠ€æœ¯åˆ†ææ¨¡å—ï¼ˆå·²å®ç°ï¼‰
    â”‚   â”œâ”€â”€ breakthrough_detector.py  # å¢é‡å¼çªç ´æ£€æµ‹æ ¸å¿ƒ
    â”‚   â”œâ”€â”€ peak_detector.py          # å³°å€¼è¯†åˆ«
    â”‚   â”œâ”€â”€ breakout_detector.py      # çªç ´æ£€æµ‹
    â”‚   â”œâ”€â”€ quality_scorer.py         # è´¨é‡è¯„åˆ†
    â”‚   â”œâ”€â”€ features.py               # ç‰¹å¾è®¡ç®—
    â”‚   â”œâ”€â”€ indicators.py             # æŠ€æœ¯æŒ‡æ ‡
    â”‚   â””â”€â”€ test/                     # é›†æˆæµ‹è¯•
    â”œâ”€â”€ data/                       # æ•°æ®å±‚ï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ search/                     # æœç´¢ç³»ç»Ÿï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ observation/                # è§‚å¯Ÿæ± ç³»ç»Ÿï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ monitoring/                 # ç›‘æµ‹ç³»ç»Ÿï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ trading/                    # äº¤æ˜“æ‰§è¡Œï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ risk/                       # é£é™©ç®¡ç†ï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ backtest/                   # å›æµ‹ç³»ç»Ÿï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ config/                     # é…ç½®ç®¡ç†ï¼ˆå¾…å®ç°ï¼‰
    â”œâ”€â”€ utils/                      # å·¥å…·æ¨¡å—ï¼ˆå¾…å®ç°ï¼‰
    â””â”€â”€ docs/                       # æŠ€æœ¯æ–‡æ¡£
        â”œâ”€â”€ plans/                  # å¼€å‘è®¡åˆ’
        â”œâ”€â”€ modules/                # æ¨¡å—è®¾è®¡æ–‡æ¡£ï¼ˆ10ä¸ªï¼‰
        â””â”€â”€ summaries/              # ç®—æ³•æ€»ç»“
```

### æ¨¡å—åˆ†å±‚

**åŸºç¡€å±‚**ï¼š
- `data/`ï¼šTiger APIæ•°æ®è·å–ã€ç¼“å­˜ã€å®æ—¶è®¢é˜…
- `config/`ï¼šYAMLé…ç½®ç®¡ç†ã€å‚æ•°éªŒè¯
- `utils/`ï¼šæ—¥å¿—ã€æ•°æ®åº“ã€å¯è§†åŒ–ã€æ—¥æœŸå·¥å…·

**åˆ†æå±‚**ï¼š
- `analysis/`ï¼šå‡¸ç‚¹è¯†åˆ«ã€çªç ´æ£€æµ‹ã€è´¨é‡è¯„åˆ†ï¼ˆ**å·²å®ç°æ ¸å¿ƒç®—æ³•**ï¼‰

**åº”ç”¨å±‚**ï¼š
- `search/`ï¼šå†å²çªç ´æœç´¢ã€è‚¡ç¥¨è¿‡æ»¤
- `observation/`ï¼šåŒè§‚å¯Ÿæ± ç®¡ç†ï¼ˆå®æ—¶è§‚å¯Ÿæ± ã€æ—¥Kè§‚å¯Ÿæ± ï¼‰
- `monitoring/`ï¼šå®æ—¶ç›‘æ§ã€ä¿¡å·æ£€æµ‹
- `trading/`ï¼šTiger APIäº¤æ˜“ã€è®¢å•ç®¡ç†
- `risk/`ï¼šæ­¢ç›ˆæ­¢æŸã€ä»“ä½ç®¡ç†

**éªŒè¯å±‚**ï¼š
- `backtest/`ï¼šç­–ç•¥å›æµ‹ã€å‚æ•°ä¼˜åŒ–

## æ ¸å¿ƒç®—æ³•ï¼ˆanalysisæ¨¡å—ï¼‰

### å¢é‡å¼çªç ´æ£€æµ‹

ç³»ç»Ÿä½¿ç”¨**å¢é‡å¼æ¶æ„**ç»´æŠ¤æ´»è·ƒå³°å€¼åˆ—è¡¨ï¼š

```python
from BreakthroughStrategy.analysis import (
    BreakthroughDetector,
    FeatureCalculator,
    QualityScorer
)

# åˆ›å»ºæ£€æµ‹å™¨
detector = BreakthroughDetector(
    symbol='AAPL',
    window=5,                    # å³°å€¼è¯†åˆ«çª—å£ï¼ˆå‰åå„5å¤©ï¼‰
    exceed_threshold=0.005,      # 0.5%çªç ´ç¡®è®¤é˜ˆå€¼
    peak_merge_threshold=0.03,   # 3%å³°å€¼å…±å­˜é˜ˆå€¼
    use_cache=False              # å›æµ‹åœºæ™¯ä¸ç”¨ç¼“å­˜
)

# æ‰¹é‡æ·»åŠ å†å²æ•°æ®
breakout_infos = detector.batch_add_bars(df, return_breakouts=True)

# è®¡ç®—ç‰¹å¾å’Œè¯„åˆ†
feature_calc = FeatureCalculator()
scorer = QualityScorer()

breakthroughs = []
for info in breakout_infos:
    # ä¸ºå³°å€¼è¯„åˆ†
    for peak in info.broken_peaks:
        scorer.score_peak(peak)

    # è®¡ç®—çªç ´ç‰¹å¾
    bt = feature_calc.enrich_breakthrough(df, info, 'AAPL')
    breakthroughs.append(bt)

# çªç ´è´¨é‡è¯„åˆ†
scorer.score_breakthroughs_batch(breakthroughs)
```

### å…³é”®ç®—æ³•ç‰¹æ€§

1. **å³°å€¼å…±å­˜ç­–ç•¥**ï¼šä»·æ ¼ç›¸è¿‘ï¼ˆ<3%ï¼‰çš„å³°å€¼å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå½¢æˆå¯†é›†é˜»åŠ›åŒº
2. **å¤šå³°å€¼çªç ´**ï¼šä¸€æ¬¡çªç ´å¯èƒ½çªç ´1-5ä¸ªå³°å€¼ï¼Œé˜»åŠ›è¶Šå¼ºçªç ´æ„ä¹‰è¶Šå¤§
3. **è´¨é‡è¯„åˆ†ç»´åº¦**ï¼š
   - å³°å€¼è´¨é‡ï¼šæ”¾é‡(25%) + é•¿Kçº¿(20%) + å‹åˆ¶æ—¶é—´(25%) + ç›¸å¯¹é«˜åº¦(15%)
   - çªç ´è´¨é‡ï¼šæ¶¨è·Œå¹…(20%) + è·³ç©º(10%) + æ”¾é‡(20%) + è¿ç»­æ€§(15%) + ç¨³å®šæ€§(15%) + **é˜»åŠ›å¼ºåº¦(20%)**
   - é˜»åŠ›å¼ºåº¦ï¼šå³°å€¼æ•°é‡ + å¯†é›†åº¦ + å³°å€¼è´¨é‡

## è¿è¡Œæµ‹è¯•

### é›†æˆæµ‹è¯•

```bash
cd BreakthroughStrategy/analysis/test
python test_integrated_system.py
```

æµ‹è¯•éªŒè¯ï¼š
- å¢é‡å¼çªç ´æ£€æµ‹æ­£ç¡®æ€§
- å¤šå³°å€¼çªç ´è¯†åˆ«
- æ”¹è¿›çš„è´¨é‡è¯„åˆ†ç³»ç»Ÿ

## å¼€å‘é˜¶æ®µ

é¡¹ç›®é‡‡ç”¨**ä¸¤æ­¥å¼€å‘æ³•**ï¼šå…ˆç¼–å†™æŠ€æœ¯è®¾è®¡æ–‡æ¡£ï¼Œå†è¿›è¡Œä»£ç å®ç°ã€‚

**å½“å‰çŠ¶æ€**ï¼š
- âœ… é˜¶æ®µä¸€ï¼ˆæ ¸å¿ƒåŸºç¡€ï¼‰ï¼šæŠ€æœ¯åˆ†ææ¨¡å—å·²å®ç°å¹¶æµ‹è¯•
- ğŸ”œ é˜¶æ®µäºŒï¼šæœç´¢ç³»ç»Ÿä¸å›æµ‹ç³»ç»Ÿ
- ğŸ”œ é˜¶æ®µä¸‰ï¼šè§‚å¯Ÿæ± ä¸ç›‘æµ‹ç³»ç»Ÿ
- ğŸ”œ é˜¶æ®µå››ï¼šäº¤æ˜“æ‰§è¡Œä¸é£é™©ç®¡ç†
- ğŸ”œ é˜¶æ®µäº”ï¼šä¼˜åŒ–ä¸éƒ¨ç½²

**æŠ€æœ¯è®¾è®¡æ–‡æ¡£**ï¼š
- æ‰€æœ‰æ¨¡å—çš„è¯¦ç»†è®¾è®¡æ–‡æ¡£ä½äº `docs/modules/`
- åŒ…å«10ä¸ªæ¨¡å—çš„æ¥å£å®šä¹‰ã€ç®—æ³•ä¼ªä»£ç ã€æ•°æ®ç»“æ„è®¾è®¡

## Tiger APIé›†æˆ

æ•°æ®æºå’Œäº¤æ˜“æ¥å£ä½¿ç”¨Tiger Open APIï¼š
- å†å²æ—¥K/åˆ†é’ŸKæ•°æ®ï¼š`get_bars()`
- å®æ—¶è¡Œæƒ…ï¼šWebSocketè®¢é˜…
- äº¤æ˜“æ‰§è¡Œï¼š`place_order()`, `cancel_order()`
- APIå‡­è¯é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ`TIGER_ID`, `TIGER_ACCOUNT`, `TIGER_PRIVATE_KEY_PATH`ï¼‰

## å…³é”®çº¦æŸ

### å‚æ•°é…ç½®
- é…ç½®ä½¿ç”¨YAMLæ ¼å¼ï¼ˆå‚è€ƒ `docs/modules/09_é…ç½®ç®¡ç†è®¾è®¡.md`ï¼‰
- æ‰€æœ‰å‚æ•°é›†ä¸­ç®¡ç†ï¼Œæ”¯æŒéªŒè¯å’Œå¤šç¯å¢ƒé…ç½®

### æ•°æ®å¤„ç†
- å†å²æ•°æ®ç¼“å­˜åˆ°SQLite/PostgreSQLé¿å…é‡å¤è¯·æ±‚
- å®æ—¶æ•°æ®ä½¿ç”¨WebSocketæ¨é€ï¼Œä¸ç¼“å­˜
- æ•°æ®éªŒè¯åŒ…æ‹¬ï¼šå¿…éœ€åˆ—æ£€æŸ¥ã€ä»·æ ¼é€»è¾‘éªŒè¯ã€å¼‚å¸¸å€¼è¿‡æ»¤

### ç®—æ³•ä¸€è‡´æ€§
**é‡è¦**ï¼šç›¸åŒçš„å¢é‡å¼ç®—æ³•ç”¨äºå›æµ‹å’Œå®æ—¶ç›‘æ§ï¼Œä¿è¯ç»“æœä¸€è‡´æ€§ï¼š
- å›æµ‹åœºæ™¯ï¼š`use_cache=False`
- å®æ—¶ç›‘æ§ï¼š`use_cache=True`ï¼ˆæ”¯æŒç¨‹åºé‡å¯åæ¢å¤çŠ¶æ€ï¼‰

## å¸¸è§ä»»åŠ¡

### æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—

1. æŸ¥é˜…å¯¹åº”çš„æŠ€æœ¯è®¾è®¡æ–‡æ¡£ï¼ˆ`docs/modules/`ï¼‰
2. æŒ‰ç…§è®¾è®¡æ–‡æ¡£ä¸­çš„æ¥å£å®šä¹‰å’Œç®—æ³•å®ç°
3. ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯åŠŸèƒ½
4. æ›´æ–°æ¨¡å—çš„`__init__.py`å¯¼å‡ºæ¥å£

### å‚æ•°è°ƒä¼˜

å…³é”®å‚æ•°ä½ç½®ï¼š
- `window`ï¼šå³°å€¼è¯†åˆ«çª—å£ï¼Œå½±å“é˜»åŠ›ä½å¼ºåº¦
- `exceed_threshold`ï¼šçªç ´ç¡®è®¤é˜ˆå€¼ï¼Œå‡å°‘å‡çªç ´
- `peak_merge_threshold`ï¼šå³°å€¼å…±å­˜é˜ˆå€¼ï¼Œå½±å“å¯†é›†é˜»åŠ›åŒºè¯†åˆ«
- è´¨é‡è¯„åˆ†æƒé‡ï¼šä½äº`QualityScorer`ç±»ä¸­

### æ‰©å±•æŠ€æœ¯æŒ‡æ ‡

åœ¨ `analysis/indicators.py` ä¸­æ·»åŠ æ–°æŒ‡æ ‡å‡½æ•°ï¼Œç„¶ååœ¨ `FeatureCalculator` ä¸­è°ƒç”¨ã€‚

## å‚è€ƒæ–‡æ¡£

- **å¼€å‘è®¡åˆ’**ï¼š`BreakthroughStrategy/docs/plans/initial_plan.md`
- **ç®—æ³•æ€»ç»“**ï¼š`BreakthroughStrategy/docs/summaries/æŠ€æœ¯åˆ†ææ¨¡å—ç®—æ³•æ€»ç»“.md`
- **æ¨¡å—è®¾è®¡**ï¼š`BreakthroughStrategy/docs/modules/01-10_*.md`ï¼ˆ10ä¸ªæ¨¡å—çš„è¯¦ç»†è®¾è®¡ï¼‰
- **Tiger APIæ–‡æ¡£**ï¼šhttps://quant.itigerup.com/openapi/zh/python/overview/introduction.html

## è´¨é‡æ ‡å‡†

### æŠ€æœ¯æ ‡å‡†
- å•å…ƒæµ‹è¯•é€šè¿‡ç‡ > 90%
- å®æ—¶ç›‘æ§å»¶è¿Ÿ < 5ç§’
- æ•°æ®è·å–æˆåŠŸç‡ > 99%

### ç­–ç•¥æ ‡å‡†ï¼ˆå›æµ‹ç›®æ ‡ï¼‰
- å¹´åŒ–æ”¶ç›Šç‡ > 15%
- å¤æ™®æ¯”ç‡ > 1.0
- æœ€å¤§å›æ’¤ < 20%
- èƒœç‡ > 50%
