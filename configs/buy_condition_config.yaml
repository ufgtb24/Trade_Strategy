# 买入条件配置
# 版本: v1.0
#
# 配置文件说明:
# 此文件定义买入时机评估的四维度参数：
# - 时间窗口: 控制买入时段的评分
# - 价格确认: 控制价格位置的评估
# - 成交量验证: 控制成交量的阈值
# - 风险过滤: 控制风险红线条件
#
# 使用方式:
# pool_mgr = create_backtest_pool_manager(
#     start_date=...,
#     config={'buy_condition_config_path': 'configs/buy_condition_config.yaml'}
# )

# ==================== 时间窗口配置 ====================
# 评估当前时间是否处于最佳买入窗口
time_window:
  # 最佳买入时间窗口 (美东时间 ET, 格式 "HH:MM")
  optimal_windows:
    - ["10:00", "11:30"]   # 开盘30分钟后到午前

  # 开盘后避开时间 (分钟)
  # 开盘前30分钟波动大，假突破多
  open_avoid_minutes: 30

  # 是否允许盘后/盘前交易
  # 美股盘后 16:00-20:00, 盘前 04:00-09:30
  allow_extended_hours: false

  # 时段评分映射 (0-1 的评分因子)
  window_scores:
    optimal: 1.0      # 最佳时段: 10:00-11:30
    acceptable: 0.7   # 可接受: 其他常规交易时间
    marginal: 0.4     # 边际: 尾盘 15:00-16:00
    avoid: 0.0        # 避开: 开盘30分钟, 盘后/盘前

# ==================== 价格确认配置 ====================
# 评估当前价格相对于突破价/峰值价的位置
price_confirm:
  # 最小突破确认比例 (1%)
  # 价格需高于参考价至少 1% 才算确认
  min_breakout_margin: 0.01

  # 最大突破确认比例 (2%)
  # 超过 2% 开始降低评分，避免追高
  max_breakout_margin: 0.02

  # 回踩容忍度 (3%)
  # 价格回踩不超过 3% 仍可接受
  pullback_tolerance: 0.03

  # 跌破移出阈值 (3%)
  # 跌破参考价 3% 以下则从观察池移出
  remove_threshold: 0.03

  # 最大追高比例 (5%)
  # 超过 5% 放弃买入，避免追高
  max_chase_pct: 0.05

# ==================== 成交量验证配置 ====================
# 评估成交量是否支持突破有效性
volume_verify:
  # 最小成交量比阈值
  # 当前成交量需达到基准成交量的 1.5 倍
  min_volume_ratio: 1.5

  # 成交量计算窗口 (分钟)
  # 实时模式下使用此窗口计算成交量
  volume_window_minutes: 5

  # 基准成交量类型
  # 'ma20': 使用 20日成交量均值
  # 'prev_day_avg': 使用前日平均成交量
  baseline_type: "ma20"

# ==================== 风险过滤配置 ====================
# 门槛条件，不参与加权计算
risk_filter:
  # 跌破移出阈值 (3%)
  # 价格跌破参考价 3% 以下则移出观察池
  drop_remove_threshold: 0.03

  # 跳空过高跳过阈值 (8%)
  # 开盘跳空超过 8% 当日跳过，避免追高
  gap_skip_threshold: 0.08

  # 最大观察天数 (30天)
  # 超过此天数未买入则标记为过期
  max_holding_days: 30

  # 连续阴线数量限制 (3根)
  # 连续 3 根阴线降低评分
  consecutive_red_limit: 3

# ==================== 综合评分配置 ====================
# 各维度权重和买入阈值
scoring:
  # 各维度权重 (总和应为1.0，风险过滤权重为0)
  time_weight: 0.20     # 时间窗口 20%
  price_weight: 0.30    # 价格确认 30%
  volume_weight: 0.25   # 成交量验证 25%
  quality_weight: 0.25  # 质量评分因子 25%

  # 强买入阈值
  # 综合评分 >= 70 分为强买入信号
  strong_buy_threshold: 70

  # 普通买入阈值
  # 综合评分 >= 50 分为普通买入信号
  normal_buy_threshold: 50

# ==================== 运行模式 ====================
# 'realtime': 实时模式，使用完整的四维度评估
# 'backtest': 回测模式，简化时间窗口评估
mode: "backtest"
