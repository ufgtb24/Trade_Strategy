# 突破选股策略系统开发计划

## 文档说明

### 开发方式选择

本项目采用**两步开发法**：

1. **第一步**：基于本计划文档，为每个核心模块编写详细的技术设计文档
2. **第二步**：基于技术设计文档进行代码实现

**选择理由**：
- 本系统是复杂的量化交易系统，涉及多个子系统协同工作
- 凸点识别、突破检测等核心算法需要详细的算法设计和伪代码
- 实盘交易涉及资金安全，必须经过仔细的架构设计和评审
- 详细的技术文档有助于模块化开发、单元测试和后续维护
- 便于在编码前发现设计缺陷，降低返工成本

### 计划文档用途

本文档定义：
- 系统的模块化架构
- 各模块的职责边界
- 模块间的依赖关系和接口
- 开发阶段划分和优先级
- 与现有代码库的复用关系

本文档**不包含**实现细节（如算法伪代码、数据结构、具体接口定义等），这些内容将在各模块的技术设计文档中详细说明。

---

## 一、项目概述

### 1.1 项目目标

开发一套完整的突破选股策略系统，用于美股市场的量化交易，实现：
- 自动识别历史阻力位（凸点）和突破走势
- 多阶段筛选和质量评估
- 双观察池监测机制（实时+日K）
- 实盘自动交易和风险管理
- 策略回测和参数优化

### 1.2 核心策略机制

**策略流程**：搜索 → 监测 → 交易 → 持仓管理

**核心概念**：
- **凸点**：股价高于两侧一定时段的高点，形成历史阻力位
- **突破点**：股价高于凸点最高价，确认突破
- **双观察池**：
  - 实时观察池：监测当日突破，防止直接起飞
  - 日K观察池：监测突破后回落，等待企稳走强
- **循环跟踪**：止盈止损后重新加入观察池，捕捉多轮波动

### 1.3 技术栈

- **编程语言**：Python 3.8+
- **数据源**：Tiger Open API（美股实时/历史行情）
- **交易接口**：Tiger Open API（下单、撤单、查询）
- **回测框架**：Backtrader（可选）或自研回测引擎
- **参数优化**：Optuna
- **数据存储**：SQLite / PostgreSQL
- **核心库**：pandas, numpy, scipy, matplotlib, pyyaml

---



## 二、系统模块化设计

### 2.1 模块总览

本系统划分为10个核心模块，按功能分层：

| 层级 | 模块 | 职责 |
|------|------|------|
| **基础层** | 数据层（data） | Tiger API数据获取、缓存、实时订阅 |
| **基础层** | 配置管理（config） | 参数配置、验证、持久化 |
| **基础层** | 工具与辅助（utils） | 日志、数据库、可视化、日期工具 |
| **分析层** | 技术分析（analysis） | 凸点识别、突破检测、质量评分 |
| **应用层** | 搜索系统（search） | 历史突破搜索、股票过滤 |
| **应用层** | 观察池（observation） | 双观察池管理、池间转换 |
| **应用层** | 监测系统（monitoring） | 实时监控、信号检测、警报 |
| **应用层** | 交易执行（trading） | Tiger API交易、订单管理、持仓追踪 |
| **应用层** | 风险管理（risk） | 止盈止损、仓位管理 |
| **验证层** | 回测系统（backtest） | 策略回测、性能分析、参数优化 |

### 2.2 模块依赖关系图

```
┌─────────────────────────────────────────────────────────┐
│                    配置管理 (config)                     │ ← 全局依赖
│                  工具与辅助 (utils)                      │
└─────────────────────────────────────────────────────────┘
                            ↑
┌───────────────────────────┼───────────────────────────┐
│                      数据层 (data)                      │
│  - TigerDataAdapter                                    │
│  - DataCache                                           │
│  - RealtimeStream                                      │
└───────────────────────────┬───────────────────────────┘
                            ↓
┌───────────────────────────┼───────────────────────────┐
│                  技术分析模块 (analysis)                 │
│  - PeakDetector (凸点识别)                             │
│  - BreakoutDetector (突破检测)                         │
│  - QualityScorer (质量评分)                            │
└───────────────────────────┬───────────────────────────┘
                            ↓
         ┌──────────────────┴──────────────────┐
         ↓                                     ↓
┌────────────────────┐              ┌────────────────────┐
│  搜索系统 (search)   │              │ 观察池 (observation)│
│  - HistoricalScanner│──────────→  │  - RealtimePool    │
│  - StockFilter      │              │  - DailyPool       │
│  - SearchEngine     │              │  - PoolManager     │
└────────────────────┘              └─────────┬──────────┘
                                              ↓
                                    ┌────────────────────┐
                                    │ 监测系统 (monitoring)│
                                    │  - RealtimeMonitor │
                                    │  - SignalDetector  │
                                    └─────────┬──────────┘
                                              ↓
                                    ┌────────────────────┐
                                    │ 交易执行 (trading)  │
                                    │  - TigerTradeAPI   │
                                    │  - OrderManager    │
                                    │  - PositionTracker │
                                    └─────────┬──────────┘
                                              ↓
                                    ┌────────────────────┐
                                    │ 风险管理 (risk)     │
                                    │  - StopLossManager │
                                    │  - TakeProfitMgr   │
                                    └────────────────────┘
         ┌──────────────────────────────────┘
         ↓
┌────────────────────┐
│  回测系统 (backtest)│
│  - BacktestEngine  │
│  - ParamOptimizer  │
└────────────────────┘
```

---

## 三、核心模块概览

系统包含10个核心模块，各模块的详细设计请参考对应的技术设计文档：

### 3.1 数据层（data/）
负责Tiger API数据获取、缓存管理、实时订阅和数据验证。
→ 详见 @BreakthroughStrategy/docs/module_plans/01_数据层设计.md

### 3.2 技术分析模块（analysis/）
实现凸点识别、突破检测、质量评分等核心算法。**✅ 已完成（v2.0 增量式架构）**
→ 详见 @BreakthroughStrategy/docs/module_plans/02_技术分析模块设计.md
→ 总结 @BreakthroughStrategy/docs/module_summaries/02_技术分析模块总结.md

### 3.3 搜索系统（search/）
扫描美股市场，应用过滤器，输出候选突破股票列表。
→ 详见 @BreakthroughStrategy/docs/module_plans/03_搜索系统设计.md

### 3.4 观察池系统（observation/）
管理双观察池（实时观察池、日K观察池）及池间转换逻辑。
→ 详见 @BreakthroughStrategy/docs/module_plans/04_观察池系统设计.md

### 3.5 监测系统（monitoring/）
实时监控观察池股票，检测买入信号，触发警报。
→ 详见 @BreakthroughStrategy/docs/module_plans/05_监测系统设计.md

### 3.6 交易执行（trading/）
与Tiger API交互执行交易，管理订单和持仓。
→ 详见 @BreakthroughStrategy/docs/module_plans/06_交易执行设计.md

### 3.7 风险管理（risk/）
实施止盈止损策略、仓位管理和风险控制。
→ 详见 @BreakthroughStrategy/docs/module_plans/07_风险管理设计.md

### 3.8 回测系统（backtest/）
使用历史数据验证策略，计算性能指标，参数优化。
→ 详见 @BreakthroughStrategy/docs/module_plans/08_回测系统设计.md

### 3.9 配置管理（config/）
管理所有参数配置，支持多环境配置和参数验证。
→ 详见 @BreakthroughStrategy/docs/module_plans/09_配置管理设计.md

### 3.10 工具与辅助（utils/）
提供日志、数据库、可视化、日期工具等基础设施。
→ 详见 @BreakthroughStrategy/docs/module_plans/10_工具与辅助设计.md

---

## 四、开发阶段规划

本项目分为5个开发阶段，采用**迭代式开发**，每个阶段交付可运行的子系统。

### 4.1 阶段一：核心基础

**目标**：建立系统的核心基础设施，实现凸点识别和突破检测算法。

**主要任务**：
1. 编写技术设计文档（数据层、技术分析模块、配置管理、工具模块）
2. 数据层开发（TigerDataAdapter、DataCache、DataValidator）
3. 技术分析模块开发（PeakDetector、BreakoutDetector、QualityScorer、TechnicalIndicators）
4. 配置管理和工具开发（ConfigManager、Logger、DatabaseManager、Visualizer）
5. 申请Tiger API账号和权限
6. 单元测试和集成测试

**验收标准**：
- 能够从Tiger API下载历史数据并缓存
- 能够识别历史数据中的凸点和突破点
- 能够对凸点和突破点进行质量评分
- 能够可视化凸点和突破点

**产出物**：技术设计文档、代码模块（data/, analysis/, config/, utils/）、测试代码和报告

---

### 4.2 阶段二：搜索与回测

**目标**：实现历史突破搜索系统，并通过回测验证策略有效性。

**主要任务**：
1. 编写技术设计文档（搜索系统、回测系统）
2. 搜索系统开发（HistoricalScanner、StockFilter、SearchEngine、ResultFormatter）
3. 回测系统开发（BacktestEngine、PerformanceAnalyzer、BacktestReporter）
4. 策略验证和优化（回测、分析、参数调整）

**验收标准**：
- 能够扫描美股市场，找到历史突破的股票
- 能够使用历史数据回测策略
- 能够生成回测报告（收益率、夏普比率、最大回撤等）
- 初步验证策略有效性

**产出物**：技术设计文档、代码模块（search/, backtest/）、回测报告、策略优化建议

---

### 4.3 阶段三：观察池与监测

**目标**：实现双观察池管理和实时监测系统。

**主要任务**：
1. 编写技术设计文档（观察池系统、监测系统）
2. 观察池系统开发（RealtimePool、DailyPool、PoolManager、PoolStorage）
3. 监测系统开发（RealtimeStream、RealtimeMonitor、SignalDetector、AlertManager、MonitorScheduler）
4. 集成测试（搜索→观察池→监测，端到端测试）

**验收标准**：
- 能够将搜索结果加入观察池
- 能够实时监控观察池中的股票
- 能够检测买入信号并发送警报
- 能够实现池间转换逻辑

**产出物**：技术设计文档、代码模块（observation/, monitoring/）、集成测试报告

---

### 4.4 阶段四：交易执行与风险管理

**目标**：实现实盘交易和风险管理系统，**小资金测试**。

**主要任务**：
1. 编写技术设计文档（交易执行、风险管理）
2. 交易执行开发（TigerTradeAPI、OrderManager、PositionTracker、ExecutionEngine）
3. 风险管理开发（StopLossManager、TakeProfitManager、PositionSizer、RiskController）
4. 小资金实盘测试（部署、测试、监控、日志记录、性能分析）

**验收标准**：
- 能够通过Tiger API执行买卖操作
- 能够实时追踪持仓和订单状态
- 能够自动执行止盈止损
- 小资金实盘测试无重大bug

**产出物**：技术设计文档、代码模块（trading/, risk/）、实盘测试报告、优化建议

---

### 4.5 阶段五：优化与部署

**目标**：参数优化、性能优化、生产部署。

**主要任务**：
1. 参数优化（实现ParameterOptimizer、历史数据优化、交叉验证）
2. 性能优化（多进程、缓存、异常处理、系统监控）
3. 生产部署（编写文档、配置环境、部署系统、逐步增加资金规模）

**验收标准**：
- 参数优化完成，找到最优参数组合
- 系统性能满足实时监控要求
- 生产环境稳定运行
- 完整的部署和运维文档

**产出物**：参数优化报告、性能优化报告、部署文档、运维手册

---

## 五、技术设计文档清单

基于模块化设计，需要编写以下技术设计文档：

| 序号 | 文档名称 | 路径 | 内容概要 |
|------|---------|------|---------|
| 01 | 数据层设计 | `docs/module_plans/01_数据层设计.md` | Tiger API接口设计、数据缓存机制、实时数据订阅、数据验证逻辑 |
| 02 | 技术分析模块设计 | `docs/module_plans/02_技术分析模块设计.md` | 凸点识别算法（含伪代码）、突破检测算法、质量评分系统、技术指标计算 |
| 03 | 搜索系统设计 | `docs/module_plans/03_搜索系统设计.md` | 历史扫描算法、过滤器设计、搜索引擎架构、结果格式定义 |
| 04 | 观察池系统设计 | `docs/module_plans/04_观察池系统设计.md` | 双观察池数据结构、池间转换逻辑、持久化存储方案、循环跟踪机制 |
| 05 | 监测系统设计 | `docs/module_plans/05_监测系统设计.md` | 实时监控架构、买入信号检测逻辑、警报系统设计、调度器设计 |
| 06 | 交易执行设计 | `docs/module_plans/06_交易执行设计.md` | Tiger API交易接口、订单管理逻辑、持仓追踪、异常处理 |
| 07 | 风险管理设计 | `docs/module_plans/07_风险管理设计.md` | 止盈止损算法、仓位管理规则、风险控制逻辑、循环跟踪实现 |
| 08 | 回测系统设计 | `docs/module_plans/08_回测系统设计.md` | 回测引擎架构、性能指标计算、参数优化方案、报告生成 |
| 09 | 配置管理设计 | `docs/module_plans/09_配置管理设计.md` | 配置文件结构、参数验证规则、多环境配置方案 |
| 10 | 工具与辅助设计 | `docs/module_plans/10_工具与辅助设计.md` | 日志系统设计、数据库表设计、可视化工具设计、日期工具设计 |

**技术设计文档模板**：

每份技术设计文档应包含：
1. **模块概述**：职责、目标、依赖关系
2. **架构设计**：模块内部架构、子模块划分
3. **接口定义**：公共接口、输入输出格式
4. **核心算法**：算法流程、伪代码、复杂度分析
5. **数据结构**：核心数据结构定义
6. **异常处理**：异常场景、处理策略
7. **性能考虑**：性能瓶颈、优化方案
8. **测试方案**：单元测试、集成测试策略
9. **未决问题**：待讨论的技术选型或设计问题

---

## 六、风险与挑战

### 6.1 技术风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| Tiger API限制或不稳定 | 数据获取失败、交易执行失败 | - 实现重试机制<br>- 设计降级方案<br>- 多数据源备份 |
| 凸点识别算法准确性不足 | 搜索结果质量差 | - 充分回测验证<br>- 参数优化<br>- 引入机器学习 |
| 实时监控性能瓶颈 | 无法及时检测买入信号 | - 使用WebSocket推送<br>- 多进程并行处理<br>- 优化算法复杂度 |
| 数据质量问题 | 错误的交易决策 | - 严格的数据验证<br>- 异常数据过滤<br>- 人工审核机制 |

### 6.2 策略风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| 策略过度拟合 | 回测表现好，实盘表现差 | - 交叉验证<br>- 样本外测试<br>- 多时间段验证 |
| 市场环境变化 | 策略失效 | - 持续监控策略表现<br>- 定期重新优化参数<br>- 设计止损机制 |
| 滑点和手续费 | 实际收益低于预期 | - 回测中考虑滑点<br>- 使用限价单控制成本 |
| 流动性不足 | 无法成交或冲击成本高 | - 严格的流动性过滤<br>- 分批建仓 |

### 6.3 实施风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| 开发时间超期 | 延迟上线 | - 迭代式开发<br>- MVP优先<br>- 灵活调整范围 |
| 资金安全 | 损失本金 | - 小资金测试<br>- 严格的风险控制<br>- 人工监督 |
| API权限和费用 | 成本增加或功能受限 | - 提前了解API限制<br>- 预算规划 |

---

## 七、成功标准

### 7.1 技术标准

- ✅ 所有模块单元测试通过率 > 90%
- ✅ 系统集成测试无重大bug
- ✅ 实时监控延迟 < 5秒
- ✅ 数据获取成功率 > 99%
- ✅ 交易执行成功率 > 95%

### 7.2 策略标准（回测）

- ✅ 年化收益率 > 15%
- ✅ 夏普比率 > 1.0
- ✅ 最大回撤 < 20%
- ✅ 胜率 > 50%
- ✅ 盈亏比 > 1.5

### 7.3 实盘标准（小资金测试）

- ✅ 系统稳定运行30天无重大故障
- ✅ 实盘收益与回测收益偏差 < 30%
- ✅ 无资金安全事故
- ✅ 所有交易有完整日志记录

---

## 八、下一步行动

### 8.1 初始准备

1. **评审本开发计划文档**
   - 确认模块划分是否合理
   - 确认开发阶段是否可行

2. **申请Tiger API账号**
   - 注册Tiger Trade账号
   - 申请API权限（行情、交易）
   - 了解API限制和费用

3. **环境准备**
   - 安装Python 3.8+
   - 安装依赖库（pandas, numpy, tigeropen, backtrader, optuna等）
   - 配置开发环境

### 8.2 第一个里程碑

1. **编写技术设计文档**：
   - `docs/modules/01_数据层设计.md`
   - `docs/modules/02_技术分析模块设计.md`
   - `docs/modules/09_配置管理设计.md`
   - `docs/modules/10_工具与辅助设计.md`

2. **技术设计文档评审**
   - 确保接口定义清晰
   - 确保算法逻辑正确
   - 确保异常处理完善

3. **创建项目目录结构**
   ```bash
   mkdir -p BreakthroughStrategy/{data,analysis,search,observation,monitoring,trading,risk,backtest,config,utils}
   mkdir -p docs/modules
   ```

### 8.3 开发里程碑

按照第四章规划的阶段顺序依次开发：
- **阶段一**：核心基础（数据层、技术分析模块、配置管理、工具）
- **阶段二**：搜索与回测（搜索系统、回测系统）
- **阶段三**：观察池与监测（观察池系统、监测系统）
- **阶段四**：交易执行与风险管理（交易执行、风险管理、小资金测试）
- **阶段五**：优化与部署（参数优化、性能优化、生产部署）

---

## 九、附录

### 9.1 术语表

| 术语 | 英文 | 定义 |
|------|------|------|
| 凸点 | Peak | 股价高于两侧一定时段的高点，形成历史阻力位 |
| 突破点 | Breakout Point | 股价高于凸点最高价，确认突破 |
| 实时观察池 | Realtime Observation Pool | 监测当日突破的股票，使用分钟行情 |
| 日K观察池 | Daily Observation Pool | 监测突破后回落的股票，使用日K行情 |
| 质量评分 | Quality Score | 对凸点和突破点的历史意义进行量化评估 |
| 循环跟踪 | Cyclic Tracking | 止盈止损后重新加入观察池，捕捉多轮波动 |
| 移动止损 | Trailing Stop Loss | 根据最高价动态调整止损价位 |

### 9.2 参考资料

- Tiger Open API官方文档：https://quant.itigerup.com/openapi/zh/python/overview/introduction.html
- Backtrader官方文档：https://www.backtrader.com/docu/
- Optuna官方文档：https://optuna.readthedocs.io/
- 突破选股策略原始文档：`docs/init_draft.md`

---

**文档版本**：v2.0
**创建日期**：2025-11-16
**最后更新**：2025-11-18
**状态**：已精简（着重宏观逻辑，模块细节见对应技术设计文档）
